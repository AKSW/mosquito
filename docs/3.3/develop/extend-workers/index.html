<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Workers - Iguana 3.3 Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
    
  
  <script>
    // Current page data
    var mkdocs_page_name = "Workers";
    var mkdocs_page_input_path = "develop/extend-workers.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
	
    <link  rel="stylesheet" href="../../css/custom.css"></link>
 
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-179945559-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-179945559-1');
</script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search" style="background-color: #82BDC3 !important;">
        <img src="../../images/Iguana_new_logo6.png" class="iguana-icon"/>
        <a href="../.."> Iguana 3.3 Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
    <ul> 
        <p  class="fa fa-caret-right  ddButton caption   "><span class="caption-text"> General</span>
 	<ul class="dd-container ">
                    <li class="toctree-l1"><a class="reference internal " href="../../about/">About</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="../../architecture/">Architecture</a>
                    </li>
                </ul>

              </ul>
    <ul> 
        <p  class="fa fa-caret-right  ddButton caption   "><span class="caption-text"> Quick Start Guide</span>
 	<ul class="dd-container ">
                    <li class="toctree-l1"><a class="reference internal " href="../../download/">Download</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="../../quick-config/">Quick Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="../../run-iguana/">Run Iguana</a>
                    </li>
                </ul>

              </ul>
    <ul> 
        <p  class="fa fa-caret-right  ddButton caption   "><span class="caption-text"> Usage</span>
 	<ul class="dd-container ">
                    <li class="toctree-l1"><a class="reference internal " href="../../usage/workflow/">Workflow</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="../../usage/configuration/">Configuration</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="../../usage/stresstest/">Stresstest</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="../../usage/workers/">Supported Workers</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="../../usage/queries/">Supported Queries</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="../../usage/languages/">Supported Languages</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="../../usage/metrics/">Metrics</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="../../usage/results/">Benchmark Results</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="../../usage/tutorial/">Tutorial</a>
                    </li>
                </ul>

              </ul>
    <ul class="current"> 
        <p  class="fa fa-caret-right  ddButton caption   active  currentSite"><span class="caption-text"> Development</span>
 	<ul class="dd-container  active">
                    <li class="toctree-l1"><a class="reference internal " href="../overview/">Overview</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal  active currentSite" href="#">Extend</a>
    <ul class="currentSite active">
                <li class="toctree-l2"><a class="reference internal " href="../extend-task/">Tasks</a>
                </li>
                <li class="toctree-l2 currentSite active"><a class="reference internal  active currentSite" href="#">Workers</a>
    <ul class="currentSite active">
    <li class="toctree-l3"><a class="reference internal" href="#constructor">Constructor</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#get-the-next-query">Get the next query</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#execute-the-current-query">Execute the current query</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal " href="../extend-queryhandling/">Query Handling</a>
                </li>
                <li class="toctree-l2"><a class="reference internal " href="../extend-lang/">Languages</a>
                </li>
                <li class="toctree-l2"><a class="reference internal " href="../extend-result-storages/">Result storage</a>
                </li>
                <li class="toctree-l2"><a class="reference internal " href="../extend-metrics/">Metrics</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal " href="#">Use Iguana</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal " href="../maven/">Maven</a>
                </li>
                <li class="toctree-l2"><a class="" href="http://iguana-benchmark.eu/javadoc/3.x/index.html">Javadoc</a>
                </li>
    </ul>
                    </li>
                </ul>

              </ul>

      </div>
    </div>
    <div style="height: 2em;"/>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Iguana 3.3 Documentation</a>

      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Extend &raquo;</li>
        
      
        
          <li>Development &raquo;</li>
        
      
    
    <li>Workers</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="extend-workers">Extend Workers</h1>
<p>If the implemented workers aren't sufficient you can create your own one. </p>
<p>Start by extending the <code>AbstractWorker</code> </p>
<pre><code class="language-java">package org.benchmark.workers

@Shorthand(&quot;MyWorker&quot;)
public class MyWorker extends AbstractWorker{


    //Setting the next query to be benchmarked in queryStr and queryID
    public void getNextQuery(StringBuilder queryStr, StringBuilder queryID) throws IOException{

    }


    //Executing the current benchmark query
    public void executeQuery(String query, String queryID){

    }

}
</code></pre>
<p>These are the only two functions you need to implement, the rest is done by the <code>AbstractWorker</code>.</p>
<p>You can override more functions, please consider looking into the javadoc for that.</p>
<h2 id="constructor">Constructor</h2>
<p>The constructor parameters will be provided the same way the Task get's the parameters, thus simply look at <a href="../extend-task">Extend Task</a>.</p>
<h2 id="get-the-next-query">Get the next query</h2>
<p>The benchmark task should create and initialize the benchmark queries and will set them accordingly to the worker.</p>
<p>You can access these queries using the <code>queryFileList</code> array. 
Each element consists of one query set, containing the queryID/name and a list of one to several queries.</p>
<p>In the following we will choose the next query set, counted by <code>currentQueryID</code> and use a random query of this. </p>
<pre><code class="language-java">
    @Override
    public void getNextQuery(StringBuilder queryStr, StringBuilder queryID) throws IOException {
        // get next Query File and next random Query out of it.
        QuerySet currentQuery = this.queryFileList[this.currentQueryID++];
        queryID.append(currentQuery.getName());

        int queriesInSet = currentQuery.size();
        int queryLine = queryChooser.nextInt(queriesInSet);
        queryStr.append(currentQuery.getQueryAtPos(queryLine));

        // If there is no more query(Pattern) start from beginning.
        if (this.currentQueryID &gt;= this.queryFileList.length) {
            this.currentQueryID = 0;
        }

    }
</code></pre>
<p>Thats it.</p>
<p>This exact method is implemented in the <code>AbstractRandomQueryChooserWorker</code> class and instead of extend the <code>AbstractWorker</code> class, you can also extend this and spare your time. 
However if you need another way like only executing one query and if there are no mery queries to test end the worker you can do so: </p>
<pre><code class="language-java">
    @Override
    public void getNextQuery(StringBuilder queryStr, StringBuilder queryID) throws IOException {
        // If there is no more query(Pattern) start from beginning.
        if (this.currentQueryID &gt;= this.queryFileList.length) {
            this.stopSending();
        }


        // get next Query File and the first Query out of it.
        QuerySet currentQuery = this.queryFileList[this.currentQueryID++];
        queryID.append(currentQuery.getName());

        int queriesInSet = currentQuery.size();
        queryStr.append(currentQuery.getQueryAtPos(0));

    }
</code></pre>
<h2 id="execute-the-current-query">Execute the current query</h2>
<p>Now you can execute the query against the current connection (<code>this.con</code>).</p>
<p>As this is up to you how to do that, here is an example implementation for using HTTP Get.</p>
<pre><code class="language-java">@Override
    public void executeQuery(String query, String queryID) {
        Instant start = Instant.now();

        try {
            String qEncoded = URLEncoder.encode(query, &quot;UTF-8&quot;);
            String addChar = &quot;?&quot;;
            if (con.getEndpoint().contains(&quot;?&quot;)) {
                addChar = &quot;&amp;&quot;;
            }
            String url = con.getEndpoint() + addChar + parameter+&quot;=&quot; + qEncoded;
            HttpGet request = new HttpGet(url);
            RequestConfig requestConfig = RequestConfig.custom().setSocketTimeout(timeOut.intValue())
                    .setConnectTimeout(timeOut.intValue()).build();

            if(this.responseType != null)
                request.setHeader(HttpHeaders.ACCEPT, this.responseType);

            request.setConfig(requestConfig);
            CloseableHttpClient client = HttpClients.createDefault();
            CloseableHttpResponse response = client.execute(request, getAuthContext(con.getEndpoint()));

            // method to process the result in background
            super.processHttpResponse(queryID, start, client, response);

        } catch (Exception e) {
            LOGGER.warn(&quot;Worker[{{}} : {{}}]: Could not execute the following query\n{{}}\n due to&quot;, this.workerType,
                    this.workerID, query, e);
            super.addResults(new QueryExecutionStats(queryID, COMMON.QUERY_UNKNOWN_EXCEPTION, durationInMilliseconds(start, Instant.now())));
        }
    }
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../extend-queryhandling/" class="btn btn-neutral float-right" title="Query Handling">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../extend-task/" class="btn btn-neutral" title="Tasks"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>
    <ul>
	<li>
 	 <a class="icon icon-github" href="https://github.com/dice-group/Iguana" > Visit us at Github</a>
	</li>
        <li>
	 <a class="icon fa-download" href="https://github.com/dice-group/Iguana/releases/latest" > Download latest Release</a>
 	</li>
    </ul>
  <div>
  </br></br>
  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../extend-task/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../extend-queryhandling/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
           SphinxRtdTheme.Navigation.enable(true);
    
}	
var dropdown = document.getElementsByClassName("ddButton");
var i;

for (i = 0; i < dropdown.length; i++) {
  if (!dropdown[i].classList.contains("active")){
	  dropdown[i].nextSibling.style.display = "none";
	  dropdown[i].classList.remove("fa-caret-down");
	  dropdown[i].classList.add("fa-caret-right");
  }
  else{
  	  dropdown[i].classList.remove("fa-caret-right");
	  dropdown[i].classList.add("fa-caret-down");
  }
  
  dropdown[i].addEventListener("click", function() {
  this.classList.toggle("active");
  
  if (this.classList.contains("currentSite")){
  	return;
  }
  var dropdownContent = this.nextElementSibling;
  if (dropdownContent.style.display === "block") {
     dropdownContent.style.display = "none";   
     this.classList.remove("fa-caret-down");
     this.classList.add("fa-caret-right");
     //this.classList.remove("active"):
  } else {
     dropdownContent.style.display = "block";
     this.classList.remove("fa-caret-right");
     this.classList.add("fa-caret-down");
     //this.classList.add("active"):

  }
  });
}

   </script>
        
</body>
</html>

